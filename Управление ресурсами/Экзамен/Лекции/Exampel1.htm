<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="Exampel1.files/filelist.xml">
<title>/*</title>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>vms</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>vms</o:LastAuthor>
  <o:Revision>1</o:Revision>
  <o:TotalTime>1</o:TotalTime>
  <o:Created>2009-04-13T11:19:00Z</o:Created>
  <o:LastSaved>2009-04-13T11:20:00Z</o:LastSaved>
  <o:Pages>7</o:Pages>
  <o:Words>1579</o:Words>
  <o:Characters>9004</o:Characters>
  <o:Company>NSTU</o:Company>
  <o:Lines>75</o:Lines>
  <o:Paragraphs>21</o:Paragraphs>
  <o:CharactersWithSpaces>10562</o:CharactersWithSpaces>
  <o:Version>11.6568</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
@page Section1
	{size:595.3pt 841.9pt;
	margin:2.0cm 42.5pt 2.0cm 3.0cm;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Ξαϋχνΰ ςΰαλθφΰ";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=RU style='tab-interval:35.4pt'>

<div class=Section1>

<p class=MsoNormal>/*<span style='mso-tab-count:1'>         </span>οπθμεπ
θροξλόηξβΰνθ ξχεπεδει ρξξαωενθι, ρεμΰτξπξβ θ πΰηδελεμξι<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>οΰμςθ β
ηΰδΰχε κξοθπξβΰνθ τΰιλξβ.<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>Οΰπΰμεςπξβ
νες.<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>Θμενΰ
θρυξδνϋυ τΰιλξβ: source_file1.txt, source_file2.ec<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
lang=EN-US style='mso-ansi-language:EN-US'>(</span>ρμ<span lang=EN-US
style='mso-ansi-language:EN-US'>. </span>μΰρρθβ<span lang=EN-US
style='mso-ansi-language:EN-US'> Table table_names)<o:p></o:p></span></p>

<p class=MsoNormal>&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;<span
style='mso-spacerun:yes'>   </span>βΰπθΰνς ρ οεχΰςόώ<span
style='mso-spacerun:yes'>  
</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<o:p></o:p></p>

<p class=MsoNormal>*/<o:p></o:p></p>

<p class=MsoNormal>#include&lt;stdio.h&gt;<o:p></o:p></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>#include&lt;stdlib.h&gt;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>#include&lt;fcntl.h&gt;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>#include&lt;sys/types.h&gt;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>#include&lt;sys/ipc.h&gt;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>#include&lt;sys/sem.h&gt;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>#include&lt;sys/shm.h&gt;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>#include&lt;sys/msg.h&gt;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>#include&lt;errno.h&gt;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>#define ERR
((struct databuf *) -1)<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>struct
databuf {<span style='mso-tab-count:1'>          </span>/* </span>ρςπσκςσπΰ<span
style='mso-ansi-language:EN-US'> </span>ρ<span style='mso-ansi-language:EN-US'>
</span>δΰννϋμθ<span style='mso-ansi-language:EN-US'> </span>θ<span
style='mso-ansi-language:EN-US'> </span>ρχεςχθκξμ<span style='mso-ansi-language:
EN-US'> </span>χςενθ<span lang=EN-US style='mso-ansi-language:EN-US'> */<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>     </span>int d_nread;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-spacerun:yes'>     </span>char d_buf[262144];<o:p></o:p></span></p>

<p class=MsoNormal>};<o:p></o:p></p>

<p class=MsoNormal>/*<span style='mso-tab-count:1'>         </span>ρλεδσώωθι
ςθο δξλζεν αϋςό ξοπεδελεν βηΰβθρθμξρςθ ξς κξντθγσπΰφθθ ΞΡ */<o:p></o:p></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>typedef
union semun {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-tab-count:1'>            </span>int val;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-tab-count:1'>            </span>struct semid_ds *buf;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-tab-count:1'>            </span>ushort_t *array;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-tab-count:1'>            </span></span>} semun;<o:p></o:p></p>

<p class=MsoNormal>typedef struct {<span style='mso-tab-count:1'>          </span>/*
ρςπσκςσπΰ ρ θμενΰμθ κξοθπσεμϋυ τΰιλξβ<span style='mso-spacerun:yes'>  
</span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
lang=EN-US style='mso-ansi-language:EN-US'>int len1;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-tab-count:1'>            </span>char *name1;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-tab-count:1'>            </span>int len2;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-tab-count:1'>            </span>char *name2;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-tab-count:1'>            </span>} Table;<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'>static
Table table_names[] = {<o:p></o:p></span></p>

<p class=MsoNormal><span lang=EN-US style='mso-ansi-language:EN-US'><span
style='mso-tab-count:1'>            </span></span>{16,
&quot;source_file1.txt&quot;, 16, &quot;target_file1.txt&quot;},<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>{15,
&quot;source_file2.ec&quot;, 14, &quot;target_file2.c&quot;},<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>{4,
&quot;quit&quot;, 4, &quot;quit&quot;},<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>{-1, NULL,
-1, NULL}<o:p></o:p></p>

<p class=MsoNormal>};<span style='mso-spacerun:yes'>             </span>/*
μΰρρθβ ρςπσκςσπ ρ θμενΰμθ κξοθπσεμϋυ τΰιλξβ<span style='mso-spacerun:yes'>  
</span>*/<o:p></o:p></p>

<p class=MsoNormal>int initsem (key_t semkey, int num)<span style='mso-tab-count:
1'>  </span><o:p></o:p></p>

<p class=MsoNormal>/* τσνκφθ θνθφθΰλθηΰφθθ νΰαξπΰ θη num ρεμΰτξπξβ<span
style='mso-spacerun:yes'>   </span>*/<o:p></o:p></p>

<p class=MsoNormal>{<o:p></o:p></p>

<p class=MsoNormal>int status =0, semid, i;<o:p></o:p></p>

<p class=MsoNormal>union semun arg;<o:p></o:p></p>

<p class=MsoNormal>if (( semid = semget (semkey, num, 0666 | IPC_CREAT
|IPC_EXCL)) == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>    </span>{<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>if (errno
== EEXIST)<span style='mso-tab-count:1'> </span>/*<span
style='mso-spacerun:yes'>  </span>ερλθ νΰαξπ ρεμΰτξπξβ ρσωερςβξβΰλ πΰνεε<span
style='mso-spacerun:yes'>   </span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>                </span>semid
= semget (semkey, num, 0);<span style='mso-spacerun:yes'>    </span>/*<span
style='mso-spacerun:yes'>   </span>ςξ ξςκπϋςό εγξ<span style='mso-tab-count:
1'>            </span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>    </span>} <o:p></o:p></p>

<p class=MsoNormal>if (semid == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>return (-1);<o:p></o:p></p>

<p class=MsoNormal>return (semid); <span style='mso-tab-count:1'>           </span><span
style='mso-spacerun:yes'> </span>}<o:p></o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>int initmsg (key_t msgkey)<span style='mso-tab-count:1'>    </span>/*
τσνκφθ θνθφθΰλθηΰφθθ ξχεπεδθ<span style='mso-spacerun:yes'>   </span>*/<o:p></o:p></p>

<p class=MsoNormal>{<o:p></o:p></p>

<p class=MsoNormal>int msgid;<o:p></o:p></p>

<p class=MsoNormal>if (( msgid = msgget (msgkey, 0600 | IPC_CREAT |IPC_EXCL))
== -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>    </span>{<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>if (errno
== EEXIST)<span style='mso-tab-count:1'> </span>/*<span
style='mso-spacerun:yes'>  </span>ερλθ ξχεπεδό ρσωερςβξβΰλΰ πΰνεε<span
style='mso-spacerun:yes'>   </span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>                </span>msgid
= msgget (msgkey, 0);<span style='mso-tab-count:1'>        </span>/*<span
style='mso-spacerun:yes'>   </span>ςξ ξςκπϋςό εε<span style='mso-tab-count:
1'>      </span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>    </span>} <o:p></o:p></p>

<p class=MsoNormal>if (msgid == -1 )<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>return (-1);<o:p></o:p></p>

<p class=MsoNormal>return (msgid); <span style='mso-tab-count:1'>           </span><span
style='mso-spacerun:yes'> </span>}<o:p></o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>int getseg (key_t segkey, struct databuf **p)<span
style='mso-tab-count:1'>           </span><o:p></o:p></p>

<p class=MsoNormal>/* τσνκφθ θνθφθΰλθηΰφθθ θ οπθρξεδθνενθ ρεγμενςΰ
οΰμςθ<span style='mso-spacerun:yes'>   </span>*/<o:p></o:p></p>

<p class=MsoNormal>{<o:p></o:p></p>

<p class=MsoNormal>int segid;<o:p></o:p></p>

<p class=MsoNormal>if (( segid = shmget (segkey, sizeof(struct databuf), <o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span>0600
| IPC_CREAT |IPC_EXCL)) == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>    </span>{<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>       </span>if (errno ==
EEXIST)<span style='mso-tab-count:1'>     </span>/*<span
style='mso-spacerun:yes'>  </span>ερλθ ρεγμενς ρσωερςβξβΰλ πΰνεε<span
style='mso-spacerun:yes'>   </span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>         </span>segid =
shmget (segkey, sizeof(struct databuf), 0);<span style='mso-spacerun:yes'> 
</span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:4'>                                               </span>/*
ςξ οξδκλώχθςό εγξ<span style='mso-tab-count:1'>           </span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>    </span>} <o:p></o:p></p>

<p class=MsoNormal>printf(&quot;************<span style='mso-spacerun:yes'> 
</span>%d\n&quot;, segid);<o:p></o:p></p>

<p class=MsoNormal>if (segid == -1 )<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>return(-1);<o:p></o:p></p>

<p class=MsoNormal>if ((*p = (struct databuf *)shmat(segid, 0, 0)) == ERR)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>return(-1);<o:p></o:p></p>

<p class=MsoNormal>return(segid);<o:p></o:p></p>

<p class=MsoNormal>}<o:p></o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>int p (int semid, int num)<o:p></o:p></p>

<p class=MsoNormal>{<span style='mso-spacerun:yes'>       </span>/* βϋοξλνενθε
τσνκφθθ p() νΰδ ρεμΰτξπξμ num<span style='mso-tab-count:1'>   </span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>struct sembuf
p_buf;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>p_buf.sem_num =
num;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>p_buf.sem_op =
-1;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>p_buf.sem_flg =
0;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>if (semop
(semid, &amp;p_buf, 1) == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>{<span
style='mso-spacerun:yes'>  </span>printf(&quot;error in p %d\n&quot;,semop
(semid, &amp;p_buf, 1)); <o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>exit
(1);<span style='mso-spacerun:yes'>  </span>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>return (0);<o:p></o:p></p>

<p class=MsoNormal>}<o:p></o:p></p>

<p class=MsoNormal>int v (int semid, int num)<o:p></o:p></p>

<p class=MsoNormal>{<span style='mso-spacerun:yes'>       </span>/* βϋοξλνενθε
τσνκφθθ v() νΰδ ρεμΰτξπξμ num<span style='mso-tab-count:1'>   </span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>struct sembuf
p_buf;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>p_buf.sem_num =
num;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>p_buf.sem_op =
1;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>     </span><span
style='mso-spacerun:yes'> </span>p_buf.sem_flg = 0;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>if (semop
(semid, &amp;p_buf, 1) == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>  </span><span
style='mso-tab-count:1'>          </span>{<span style='mso-spacerun:yes'>  
</span>printf(&quot;error in v %d\n&quot;,semop (semid, &amp;p_buf, 1)); <o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>exit (1); }<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>return (0);<o:p></o:p></p>

<p class=MsoNormal>}<o:p></o:p></p>

<p class=MsoNormal>main()<o:p></o:p></p>

<p class=MsoNormal>{<o:p></o:p></p>

<p class=MsoNormal>/* κλώχθ ρπεδρςβ IPC */<o:p></o:p></p>

<p class=MsoNormal>key_t semkey = 0X200, msgkey = 0X201, segkey1 = 0X202,
segkey2 = 0X203;<o:p></o:p></p>

<p class=MsoNormal>/* πΰημεπ ρεγμενςΰ πΰηδελεμξι οΰμςθ */<o:p></o:p></p>

<p class=MsoNormal>size_t size = 262144, len;<o:p></o:p></p>

<p class=MsoNormal>int i, num, semid, msgid, segid1, segid2, ret_code, status;<o:p></o:p></p>

<p class=MsoNormal>int fd1;<span style='mso-spacerun:yes'>       </span>/*<span
style='mso-tab-count:1'>  </span>δερκπθοςξπ<span style='mso-tab-count:1'>    </span>*/<o:p></o:p></p>

<p class=MsoNormal>pid_t pid;<o:p></o:p></p>

<p class=MsoNormal>char name_file[20], buf[100];<o:p></o:p></p>

<p class=MsoNormal>union semun arg;<span style='mso-spacerun:yes'>     
</span>/*<span style='mso-spacerun:yes'>  </span>δλ θνθφθΰλθηΰφθθ ρεμΰτξπΰ */ <o:p></o:p></p>

<p class=MsoNormal>struct msqid_ds msq_stat;<o:p></o:p></p>

<p class=MsoNormal>struct shmid_ds shm_stat;<o:p></o:p></p>

<p class=MsoNormal>struct q_entry {<span style='mso-tab-count:2'>                      </span>/*
ρςπσκςσπΰ δλ πΰαξςϋ ρ ξχεπεδόώ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>     </span>long mtype;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>     </span>char mtext[20];<o:p></o:p></p>

<p class=MsoNormal>};<o:p></o:p></p>

<p class=MsoNormal>struct databuf *buf1, *buf2;<o:p></o:p></p>

<p class=MsoNormal>struct q_entry s_entry, t_entry;<o:p></o:p></p>

<p class=MsoNormal>Table *tb;<span style='mso-tab-count:1'>        </span>/*
σκΰηΰςελό νΰ μΰρρθβ ρςπσκςσπ<span style='mso-spacerun:yes'>  </span>*/<o:p></o:p></p>

<p class=MsoNormal>printf (&quot;Program is begining\n&quot;);<o:p></o:p></p>

<p class=MsoNormal>/*<span style='mso-tab-count:1'>         </span>θνθφθΰλθηΰφθ
ρεμΰτξπξβ, ξχεπεδει, πΰηδελεμλι οΰμςθ<span style='mso-spacerun:yes'> 
</span>*/<o:p></o:p></p>

<p class=MsoNormal>if ((semid = initsem (semkey,4)) &lt; 0)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>{
printf(&quot;semid= %d<span style='mso-spacerun:yes'>   </span>errno=
%d\n&quot;,semid, errno);<span style='mso-spacerun:yes'>   </span>exit (1);}<o:p></o:p></p>

<p class=MsoNormal>printf (&quot;Semophore is OK semid=%d\n&quot;,semid);<o:p></o:p></p>

<p class=MsoNormal>if ((msgid = initmsg (msgkey)) &lt; 0)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>{
printf(&quot;msgid= %d\n&quot;,msgid);<span style='mso-tab-count:1'>        </span><span
style='mso-spacerun:yes'>  </span>exit (1);}<o:p></o:p></p>

<p class=MsoNormal>printf (&quot;Query is OK msgid= %d\n&quot;,msgid);<o:p></o:p></p>

<p class=MsoNormal>if ((segid1=getseg (segkey1, &amp;buf1)) &lt; 0)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>exit (1);<o:p></o:p></p>

<p class=MsoNormal>printf (&quot;1 segment is created and attached; segid1=%d\n&quot;,segid1);<o:p></o:p></p>

<p class=MsoNormal>if ((segid2=getseg (segkey2, &amp;buf2)) &lt; 0)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>exit (1);<o:p></o:p></p>

<p class=MsoNormal>printf (&quot;2 segment is created and attached;
segid2=%d\n&quot;,segid2);<o:p></o:p></p>

<p class=MsoNormal>for (tb=table_names; tb-&gt;name1 != NULL; tb++)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>    </span>{<span
style='mso-spacerun:yes'>  </span><span style='mso-tab-count:1'>    </span>printf(&quot;len1=
%d<span style='mso-spacerun:yes'>  </span>name1= %s len2= %d<span
style='mso-spacerun:yes'>  </span>name2= %s\n&quot;,<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>tb-&gt;len1,
tb-&gt;name1, tb-&gt;len2, tb-&gt;name2);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>s_entry.mtype
= 1;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>len =
tb-&gt;len1;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>strncpy(s_entry.mtext,
tb-&gt;name1, 20);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>if
(msgsnd(msgid, &amp;s_entry, len, 0) == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>{<span style='mso-tab-count:1'>      </span>printf
(&quot;error of send message\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>return(-1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>} <span style='mso-tab-count:1'>     </span>/*
βϋαπΰλθ θντξπμΰφθώ θη μΰρρθβΰ θ οξρλΰλθ β οεπβσώ ξχεπεδό */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>printf
(&quot;message has sent to query\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>s_entry.mtype
= 2;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>len =
tb-&gt;len2;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>strncpy(s_entry.mtext,
tb-&gt;name2, 20);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>if
(msgsnd(msgid, &amp;s_entry, len, 0) == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>{<span style='mso-tab-count:1'>      </span>printf
(&quot;error of send message\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>return(-1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>} <span style='mso-tab-count:1'>     </span>/*
βϋαπΰλθ θντξπμΰφθώ θη μΰρρθβΰ θ οξρλΰλθ βξ βςξπσώ ξχεπεδό */<span
style='mso-tab-count:2'>                        </span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>printf
(&quot;message has sent to query\n&quot;);<span style='mso-spacerun:yes'>      
</span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></p>

<p class=MsoNormal>/* θνθφθΰλθηθπξβΰςό ηνΰχενθ ρεμΰτξπξβ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>     </span><span
style='mso-tab-count:1'>       </span>for (i = 0;<span
style='mso-spacerun:yes'>  </span>i &lt; 4; i++)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>{<span
style='mso-spacerun:yes'>   </span>arg.val = 0;<span style='mso-tab-count:1'> </span>/*
νΰχΰλόνξε ηνΰχενθε ρεμΰτξπΰ<span style='mso-tab-count:1'>    </span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>status = semctl (semid, i, SETVAL, arg); <o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>printf(&quot;sem=%d<span
style='mso-spacerun:yes'>   </span>status=%d<span style='mso-spacerun:yes'> 
</span>errno=%d\n&quot;, i, status, errno);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>        </span>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>/*<span
style='mso-spacerun:yes'>  </span>ηνΰχενθ οεπβξγξ θ βςξπξγξ ρεμΰτξπξβ
σρςΰνξβθςό β 1<span style='mso-spacerun:yes'>   </span>*/<o:p></o:p></p>

<p class=MsoNormal>v(semid,0);<o:p></o:p></p>

<p class=MsoNormal>v(semid,1);<o:p></o:p></p>

<p class=MsoNormal>if (fork() == 0)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>   </span>{<span
style='mso-spacerun:yes'>    </span><span style='mso-tab-count:1'>   </span>/*<span
style='mso-spacerun:yes'>  </span>οεπβϋι οξςξμξκ<span
style='mso-spacerun:yes'>   </span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>pid = getpid();<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>for (;;)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>         </span>{<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>            </span>if
((status=msgrcv(msgid, &amp;t_entry, 20, 1, 0)) == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>       </span>{<span style='mso-spacerun:yes'>  
</span>printf (&quot;error of get message\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>return(-1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'> </span><span
style='mso-tab-count:1'>           </span><span style='mso-spacerun:yes'>      
</span>}<span style='mso-spacerun:yes'>    </span>/* βϋαπΰλθ θντξπμΰφθώ θη
οεπβξι ξχεπεδθ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>            </span>printf
(&quot;message has got from query1\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>            </span>if
(strncmp(t_entry.mtext, &quot;quit&quot;,status) == 0) exit(0);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>strncpy(name_file, t_entry.mtext, status);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>name_file[status]='\0';<span
style='mso-tab-count:1'>        </span>/* βϋαπΰλθ θμ ξχεπεδνξγξ τΰιλΰ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>   
</span>printf(&quot;name_file=%s\n&quot;,name_file);<span
style='mso-spacerun:yes'>  </span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>fd1=open(name_file, O_RDONLY);<span
style='mso-spacerun:yes'>  </span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>printf(&quot;fd=%d<span
style='mso-spacerun:yes'>  </span>name_file=%s\n<span
style='mso-spacerun:yes'>  </span>%s\n&quot;,fd1,name_file,buf);<span
style='mso-spacerun:yes'>  </span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>for(;;)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>       </span><span style='mso-tab-count:1'>     </span>{
/*<span style='mso-spacerun:yes'>  </span>χθςΰεμ β 1-ι αστεπ, ερλθ οξηβξλες
ρεμΰτξπ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-tab-count:1'>            </span><span style='mso-spacerun:yes'>    
</span>p(semid,0);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>  </span><span
style='mso-tab-count:2'>                      </span><span
style='mso-spacerun:yes'>     </span>status = read(fd1, buf1-&gt;d_buf,
262144);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>     </span>printf(&quot;status of read to 1
buf=%d\n&quot;,status); <o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>     </span>if (status == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span>{<span
style='mso-spacerun:yes'>    </span>printf(&quot;read error\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span><span
style='mso-spacerun:yes'>     </span>exit(1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>     </span>buf1-&gt;d_nread = status;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>       </span>v(semid,2);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>     </span>if (status == 0)<span
style='mso-spacerun:yes'>  </span>break;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>  </span>/*<span style='mso-spacerun:yes'> 
</span>χθςΰεμ βξ 2-ι αστεπ, ερλθ οξηβξλες ρεμΰτξπ */<span style='mso-tab-count:
3'>                             </span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>     </span>p(semid,1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>     </span>status = read(fd1, buf2-&gt;d_buf,
262144);<span style='mso-spacerun:yes'>  </span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>     </span>printf(&quot;status of read to 2
buf=%d\n&quot;,status); <o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>     </span>if (status == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span>{<span
style='mso-spacerun:yes'>    </span>printf(&quot;read error\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span><span
style='mso-spacerun:yes'>     </span>exit(1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>     </span>buf2-&gt;d_nread = status;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>     </span>v(semid,3);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>     </span>if (status == 0)<span
style='mso-spacerun:yes'>  </span>break;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>}<span
style='mso-tab-count:1'>          </span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>close
(fd1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>printf(&quot;read
file %s is closed\n&quot;,name_file);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>/*
δξζδΰςόρ οξδςβεπζδενθ ξα ξκξνχΰνθθ ηΰοθρθ τΰιλΰ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>            </span>if
((status=msgrcv(msgid, &amp;t_entry, 20, 3, 0)) == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>       </span>{<span style='mso-spacerun:yes'>  
</span>printf (&quot;error of get message\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>return(-1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'> </span><span
style='mso-tab-count:1'>           </span><span style='mso-spacerun:yes'>      
</span>}<span style='mso-spacerun:yes'>    </span>/* βϋαπΰλθ θντξπμΰφθώ θη
ςπεςόει ξχεπεδθ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>            </span>printf
(&quot;message %s has got from query3\n&quot;,t_entry.mtext);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>            </span>if
(strncmp(t_entry.mtext, &quot;finish&quot;,status) == 0) <o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>{<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>/*
θνθφθΰλθηθπξβΰςό ηνΰχενθ ρεμΰτξπξβ δλ ρλεδσώωει θςεπΰφθθ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>            </span>for (i = 0;<span
style='mso-spacerun:yes'>  </span>i &lt; 4; i++)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span>{<span
style='mso-spacerun:yes'>   </span>arg.val = 0;<span style='mso-spacerun:yes'> 
</span>/* νΰχΰλόνξε ηνΰχενθε ρεμΰτξπξβ<span style='mso-spacerun:yes'> 
</span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span><span
style='mso-spacerun:yes'>    </span>status = semctl (semid, i, SETVAL, arg); <o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span><span
style='mso-spacerun:yes'>    </span>printf(&quot;sem=%d<span
style='mso-spacerun:yes'>   </span>status=%d<span style='mso-spacerun:yes'> 
</span>errno=%d\n&quot;, i, status, errno);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>        </span>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>/*<span
style='mso-spacerun:yes'>  </span>ηνΰχενθ οεπβξγξ θ βςξπξγξ ρεμΰτξπξβ
σρςΰνξβθςό β 1<span style='mso-spacerun:yes'>   </span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>    </span>v(semid,0);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span><span style='mso-tab-count:1'>        </span><span
style='mso-spacerun:yes'>    </span>v(semid,1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>   </span>}<o:p></o:p></p>

<p class=MsoNormal>else if (fork() == 0)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>   </span>{<span
style='mso-spacerun:yes'>        </span><span style='mso-tab-count:1'>           </span>/*<span
style='mso-spacerun:yes'>  </span>βςξπξι οξςξμξκ<span
style='mso-spacerun:yes'>   </span>*/<span style='mso-tab-count:1'>         </span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>pid = getpid();<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>      </span>for (;;)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>         </span>{<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>            </span>if
((status=msgrcv(msgid, &amp;t_entry, 20, 2, 0)) == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>       </span>{<span style='mso-spacerun:yes'>  
</span>printf (&quot;error of get message\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>return(-1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'> </span><span
style='mso-tab-count:1'>           </span><span style='mso-spacerun:yes'>      
</span>}<span style='mso-spacerun:yes'>    </span>/* βϋαπΰλθ θντξπμΰφθώ θη
βςξπξι ξχεπεδθ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>            </span>printf
(&quot;message has got from query2\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>            </span>if
(strncmp(t_entry.mtext, &quot;quit&quot;,status) == 0) exit(0);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>strncpy(name_file, t_entry.mtext, status);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>name_file[status]='\0';<span
style='mso-tab-count:1'>        </span>/* βϋαπΰλθ θμ ξχεπεδνξγξ τΰιλΰ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>printf(&quot;name_file=%s\n&quot;,name_file);<span
style='mso-spacerun:yes'>  </span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>fd1=open(name_file, O_CREAT | O_WRONLY,
0666);<span style='mso-spacerun:yes'>  </span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>printf(&quot;fd=%d<span
style='mso-spacerun:yes'>  </span>name_file=%s\n<span
style='mso-spacerun:yes'>  </span>%s\n&quot;,fd1,name_file,buf);<span
style='mso-spacerun:yes'>  </span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>for(;;)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>{<span
style='mso-spacerun:yes'>  </span>/* οθψεμ θη 1-γξ αστεπΰ, ερλθ οξηβξλες
ρεμΰτξπ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>p(semid,2);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>if (buf1-&gt;d_nread == 0)<span
style='mso-spacerun:yes'>  </span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>{
printf(&quot;nothing to read: buf1-&gt;d_nread=%d\n&quot;,buf1-&gt;d_nread);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span>break;
}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>status = write(fd1, buf1-&gt;d_buf,
buf1-&gt;d_nread);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>printf(&quot;status of write from 1 buf=%d
buf1-&gt;d_nread=%d\n&quot;,<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span>status,buf1-&gt;d_nread);
<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>v(semid,0);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>if (status == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>      </span>{<span style='mso-tab-count:1'>    </span><span
style='mso-spacerun:yes'>   </span>printf(&quot;write error\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span><span
style='mso-spacerun:yes'>   </span>exit(1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>      </span>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>  </span>/* οθψεμ θη 2-γξ αστεπΰ, ερλθ οξηβξλες
ρεμΰτξπ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>p(semid,3);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>if (buf2-&gt;d_nread == 0)<span
style='mso-spacerun:yes'>  </span><o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>{
printf(&quot;nothing to read: buf2-&gt;d_nread=%d\n&quot;,buf2-&gt;d_nread);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span>break;
}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>                  
</span>status = write(fd1, buf2-&gt;d_buf, buf2-&gt;d_nread);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>printf(&quot;status of write from 2 buf=%d
buf2-&gt;d_nread=%d\n&quot;,<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span>status,buf2-&gt;d_nread);
<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>v(semid,1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>if (status == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>      </span>{<span style='mso-tab-count:1'>    </span><span
style='mso-spacerun:yes'>   </span>printf(&quot;write error\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span><span
style='mso-spacerun:yes'>   </span>exit(1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>  </span><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>/*
θνθφθΰλθηθπξβΰςό ηνΰχενθ ρεμΰτξπξβ δλ ρλεδσώωει θςεπΰφθθ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>                </span>for (i
= 0;<span style='mso-spacerun:yes'>  </span>i &lt; 4; i++)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>   </span><span
style='mso-tab-count:2'>                     </span><span
style='mso-spacerun:yes'>   </span>{<span style='mso-spacerun:yes'>  
</span>arg.val = 0;<span style='mso-tab-count:1'>         </span>/* νΰχΰλόνξε
ηνΰχενθε ρεμΰτξπξβ<span style='mso-tab-count:1'>  </span>*/<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>  </span><span
style='mso-tab-count:2'>                      </span><span
style='mso-spacerun:yes'>       </span>status = semctl (semid, i, SETVAL, arg);
<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>  </span><span
style='mso-tab-count:2'>                      </span><span
style='mso-spacerun:yes'>       </span>printf(&quot;sem=%d <span
style='mso-spacerun:yes'>  </span>status=%d<span style='mso-spacerun:yes'> 
</span>errno=%d\n&quot;, i, status, errno);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>   </span>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>/* οξρλΰςό
οξδςβεπζδενθ ξα ξκξνχΰνθθ ηΰοθρθ τΰιλΰ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>s_entry.mtype
= 3;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>len
= 6;<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>strncpy(s_entry.mtext,
&quot;finish&quot;, 20);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>if
(msgsnd(msgid, &amp;s_entry, len, 0) == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>    </span>{<span style='mso-tab-count:1'>      </span>printf
(&quot;error of send message\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                   </span>return(-1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
style='mso-spacerun:yes'>    </span>} <span style='mso-tab-count:1'>     </span>/*
οξρλΰλθ ρξξαωενθε β ςπεςόώ ξχεπεδό */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>printf
(&quot;finish message has sent to query\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>close(fd1);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>printf(&quot;write
file %s is closed\n&quot;,name_file);<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>   </span>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>     </span>else<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>for (i =
0;<span style='mso-spacerun:yes'>  </span>i &lt; 2; i++)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
style='mso-spacerun:yes'>    </span>wait(&amp;ret_code);<span
style='mso-spacerun:yes'>    </span>/* ζδεμ ηΰβεπψενθ οξςξμκξβ */<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>printf(&quot;father
ended\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>/* σδΰλενθε ρπεδρςβ IPC */<o:p></o:p></p>

<p class=MsoNormal>status = semctl (semid, 0, IPC_RMID, arg); <o:p></o:p></p>

<p class=MsoNormal>if (status == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>printf(&quot;error
of RMD sem\n&quot;);<span style='mso-spacerun:yes'>    </span><span
style='mso-tab-count:1'>       </span><o:p></o:p></p>

<p class=MsoNormal>else<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>printf(&quot;sem
RMD is OK\n&quot;);<o:p></o:p></p>

<p class=MsoNormal>status = msgctl (msgid, IPC_RMID, &amp;msq_stat); <o:p></o:p></p>

<p class=MsoNormal>if (status == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>printf(&quot;error
of RMD mes\n&quot;);<span style='mso-spacerun:yes'>    </span><span
style='mso-tab-count:1'>       </span><o:p></o:p></p>

<p class=MsoNormal>else<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>printf(&quot;mes
RMD is OK\n&quot;);<o:p></o:p></p>

<p class=MsoNormal>status = shmctl (segid1, IPC_RMID, &amp;shm_stat); <o:p></o:p></p>

<p class=MsoNormal>if (status == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>printf(&quot;error
of RMD seg1\n&quot;);<span style='mso-spacerun:yes'>    </span><span
style='mso-tab-count:1'>      </span><o:p></o:p></p>

<p class=MsoNormal>else<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>printf(&quot;seg1
RMD is OK\n&quot;);<o:p></o:p></p>

<p class=MsoNormal>status = shmctl (segid2, IPC_RMID, &amp;shm_stat); <o:p></o:p></p>

<p class=MsoNormal>if (status == -1)<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>printf(&quot;error
of RMD seg2\n&quot;);<span style='mso-spacerun:yes'>    </span><span
style='mso-tab-count:1'>      </span><o:p></o:p></p>

<p class=MsoNormal>else<o:p></o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>printf(&quot;seg2
RMD is OK\n&quot;);<o:p></o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>}<o:p></o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>    </span><o:p></o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
